<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CareerOS — Local Prompt → Response DB with Visual Design</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Chat bubble base */
    .bubble {
      display: inline-block;
      padding: 0.5rem 0.75rem;
      border-radius: 12px;
      max-width: 78%;
      word-break: break-word;
      position: relative;
      line-height: 1.4;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      animation: fadeIn 0.3s ease forwards;
    }
    /* User message container */
    .msg-user {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 1rem;
    }
    /* AI message container */
    .msg-ai {
      display: flex;
      justify-content: flex-start;
      margin-bottom: 1rem;
    }

    /* User bubble style */
    .bubble.user {
      background-color: #2563eb; /* blue-600 */
      color: white;
      box-shadow: 0 0 8px 2px rgba(37, 99, 235, 0.6);
    }
    /* AI bubble style */
    .bubble.ai {
      background-color: #ecfdf5; /* green-50 */
      color: #065f46; /* green-800 */
      box-shadow: 0 0 10px 3px rgba(5, 150, 105, 0.5);
    }

    /* Badge style */
    .badge {
      position: absolute;
      top: -1.2rem;
      left: 0.5rem;
      font-size: 0.6rem;
      font-weight: 700;
      text-transform: uppercase;
      padding: 0.1rem 0.5rem;
      border-radius: 8px;
      user-select: none;
      pointer-events: none;
      letter-spacing: 0.05em;
    }
    .badge.user {
      background-color: #3b82f6; /* blue-500 */
      color: white;
    }
    .badge.ai {
      background-color: #10b981; /* green-500 */
      color: white;
    }

    /* fadeIn animation for messages */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Overall page style */
    body {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
        sans-serif;
      background-color: #f8fafc; /* slate-50 */
      color: #0f172a; /* slate-900 */
      margin: 0;
    }

    /* Responsive layout */
    @media (max-width: 640px) {
      .md\:flex-1 {
        width: 100%;
      }
      .md\:flex {
        flex-direction: column;
      }
    }

    /* Analytics panel margin */
    #analyticsPanel div {
      margin-bottom: 0.5rem;
    }

    /* Chat box scrollbar styling */
    #chatBox {
      scrollbar-width: thin;
      scrollbar-color: #94a3b8 #e2e8f0;
    }
    #chatBox::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    #chatBox::-webkit-scrollbar-track {
      background: #e2e8f0;
      border-radius: 8px;
    }
    #chatBox::-webkit-scrollbar-thumb {
      background-color: #94a3b8;
      border-radius: 8px;
      border: 2px solid #e2e8f0;
    }

    /* Button hover */
    button {
      transition: background-color 0.2s ease, color 0.2s ease;
    }
    button:hover:not(:disabled) {
      background-color: #2563eb; /* blue-600 */
      color: white;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Input and select focus */
    input, select, textarea {
      font-family: inherit;
      font-size: 1rem;
      border: 1px solid #cbd5e1; /* slate-300 */
      transition: border-color 0.2s ease;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    }

    /* Modal overlay z-index */
    #modal, #respModal {
      z-index: 9999;
    }

    /* Advisor pill label above input */
    #advisorLabel {
      font-weight: 700;
      background-color: #2563eb; /* blue-600 */
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 9999px;
      display: inline-block;
      margin-bottom: 0.4rem;
      font-size: 0.85rem;
      user-select: none;
    }
  </style>
</head>
<body>
  <div class="min-h-screen flex items-center justify-center p-6">
    <div id="app" class="w-full max-w-5xl bg-white shadow-lg rounded-lg overflow-hidden flex flex-col">
      <header class="flex items-center justify-between p-6 border-b border-slate-200 bg-slate-100">
        <h1 class="text-2xl font-bold tracking-tight text-slate-900">CareerOS — Local Prompt → Response DB</h1>
        <div class="flex gap-3 items-center">
          <select id="advisor" class="px-3 py-2 border rounded text-sm bg-white shadow-sm focus:ring-2 focus:ring-blue-600" aria-label="Select advisor">
            <option>Resume Builder</option>
            <option>Interview Prep</option>
            <option>Career Path</option>
            <option>Upskilling Guide</option>
            <option>College Abroad</option>
          </select>
          <button id="export" class="px-4 py-2 border border-blue-600 rounded text-blue-600 font-semibold hover:bg-blue-600 hover:text-white transition">Export JSON</button>
          <button id="clearDB" class="px-4 py-2 border border-red-600 rounded text-red-600 font-semibold hover:bg-red-600 hover:text-white transition">Clear DB</button>
        </div>
      </header>

      <main class="md:flex flex-grow overflow-hidden">
        <!-- Left main section -->
        <section class="md:flex-1 p-6 flex flex-col">
          <div class="mb-4">
            <div id="samples" class="flex flex-wrap gap-2 text-sm"></div>
          </div>

          <div id="chatBox" class="flex-grow border rounded p-4 overflow-y-auto bg-slate-50 shadow-inner" role="log" aria-live="polite" aria-relevant="additions"></div>

          <!-- Large visible advisor label above input -->
          <div id="advisorLabel" aria-live="polite" aria-atomic="true"></div>

          <div class="mt-2 flex gap-3">
            <input
              id="input"
              class="flex-grow border rounded px-4 py-3 text-base placeholder:text-slate-400 focus:ring-2 focus:ring-blue-600"
              placeholder="Ask your advisor..."
              autocomplete="off"
              spellcheck="false"
              aria-label="Prompt input"
            />
            <button id="send" class="bg-blue-600 text-white px-6 py-3 rounded font-semibold shadow hover:bg-blue-700 transition" aria-label="Send prompt">
              Send
            </button>
          </div>

          <div class="mt-3 flex justify-between text-xs text-slate-500">
            <div>Mode: <strong id="modeLabel">Local KB only</strong></div>
            <div id="status" aria-live="polite"></div>
          </div>
        </section>

        <!-- Sidebar -->
        <aside class="w-full md:w-96 border-l p-6 bg-slate-50 flex flex-col justify-between">
          <div>
            <h3 class="font-semibold text-lg mb-4 text-slate-800">KB Stats</h3>
            <div class="text-sm space-y-3 mb-6">
              <div>Total stored pairs: <strong id="pairs">0</strong></div>
              <div>Distinct prompts: <strong id="distinct">0</strong></div>
            </div>

            <h4 class="font-semibold mb-3 text-slate-700">Quick Actions</h4>
            <div class="flex flex-col gap-3 mb-6">
              <button id="showAll" class="px-3 py-2 border rounded text-sm bg-white hover:bg-blue-50 transition">Show all stored pairs</button>
              <button id="suggest" class="px-3 py-2 border rounded text-sm bg-white hover:bg-blue-50 transition">Suggest sample prompts</button>
            </div>

            <hr class="my-6 border-slate-300" />

            <h3 class="font-semibold text-lg mb-4 text-slate-800">Data Analytics</h3>
            <div id="analyticsPanel" class="text-sm text-slate-700 space-y-2">
              <div>Total queries this session: <strong id="totalQueries">0</strong></div>
              <div>Average prompt length: <strong id="avgPromptLength">0</strong> characters</div>
              <div>Most frequent prompt: <strong id="mostFreqPrompt">N/A</strong></div>
              <div>Number of distinct advisors used: <strong id="distinctAdvisors">0</strong></div>
              <div>Prompts by advisor:</div>
              <ul id="promptsByAdvisor" class="list-disc list-inside text-xs ml-4 min-h-[3rem]"></ul>
            </div>
          </div>

          <p class="text-xs text-slate-500 mt-6">
            This version stores answers locally. When a prompt is unknown you'll be asked to type the assistant's reply and save it into the KB.
          </p>
        </aside>
      </main>
    </div>
  </div>

  <!-- Modal: list -->
  <div
    id="modal"
    class="fixed inset-0 bg-black/40 hidden items-center justify-center p-6"
    role="dialog"
    aria-modal="true"
    aria-labelledby="modalTitle"
  >
    <div
      class="bg-white w-full max-w-3xl rounded shadow p-6 max-h-[80vh] overflow-auto"
      tabindex="-1"
    >
      <div class="flex justify-between items-center mb-4">
        <h4 id="modalTitle" class="font-semibold text-lg">Stored Prompt → Response Pairs</h4>
        <button
          id="closeModal"
          class="px-3 py-1 border rounded text-sm hover:bg-slate-100 transition"
          aria-label="Close modal"
        >
          Close
        </button>
      </div>
      <div id="pairsList" class="text-sm space-y-4"></div>
    </div>
  </div>

  <!-- Modal: add response for unknown prompt -->
  <div
    id="respModal"
    class="fixed inset-0 bg-black/40 hidden items-center justify-center p-6"
    role="dialog"
    aria-modal="true"
    aria-labelledby="respModalTitle"
  >
    <div
      class="bg-white w-full max-w-lg rounded shadow p-6"
      tabindex="-1"
    >
      <h4 id="respModalTitle" class="font-semibold text-lg mb-3">No saved response — add one</h4>
      <div class="text-xs text-slate-600 mb-4" id="respMeta"></div>
      <textarea
        id="respInput"
        class="w-full border rounded p-3 text-sm resize-y focus:ring-2 focus:ring-blue-600"
        rows="8"
        placeholder="Type the assistant's reply here..."
        aria-label="Response input"
      ></textarea>
      <div class="mt-4 flex justify-end gap-3">
        <button
          id="respCancel"
          class="px-4 py-2 border rounded text-sm hover:bg-slate-100 transition"
        >
          Cancel
        </button>
        <button
          id="respSave"
          class="px-4 py-2 bg-green-600 text-white rounded text-sm font-semibold hover:bg-green-700 transition"
        >
          Save &amp; show
        </button>
      </div>
    </div>
  </div>

  <script>
    (() => {
      const STORAGE_KEY = 'careeros_pairs_v1';
      let DB = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');

      // Runtime trackers
      let sessionQueries = 0;
      const sessionPrompts = [];
      const sessionAdvisorsUsed = new Set();

      // DOM elements
      const advisorSel = document.getElementById('advisor');
      const samplesEl = document.getElementById('samples');
      const chatBox = document.getElementById('chatBox');
      const input = document.getElementById('input');
      const sendBtn = document.getElementById('send');
      const statusEl = document.getElementById('status');
      const pairsCountEl = document.getElementById('pairs');
      const distinctEl = document.getElementById('distinct');
      const exportBtn = document.getElementById('export');
      const clearDBBtn = document.getElementById('clearDB');
      const showAllBtn = document.getElementById('showAll');
      const modal = document.getElementById('modal');
      const pairsList = document.getElementById('pairsList');
      const closeModal = document.getElementById('closeModal');
      const suggestBtn = document.getElementById('suggest');

      const respModal = document.getElementById('respModal');
      const respInput = document.getElementById('respInput');
      const respMeta = document.getElementById('respMeta');
      const respSave = document.getElementById('respSave');
      const respCancel = document.getElementById('respCancel');

      // Analytics DOM elements
      const totalQueriesEl = document.getElementById('totalQueries');
      const avgPromptLengthEl = document.getElementById('avgPromptLength');
      const mostFreqPromptEl = document.getElementById('mostFreqPrompt');
      const distinctAdvisorsEl = document.getElementById('distinctAdvisors');
      const promptsByAdvisorEl = document.getElementById('promptsByAdvisor');

      // New advisor label above input
      const advisorLabel = document.getElementById('advisorLabel');

      // Sample prompts per advisor
      const SAMPLE_PROMPTS = {
        "Resume Builder": [
          "Rewrite this 2-line summary for a CS grad with ML internship.",
          "5 bullet points for a fintech software intern role.",
          "How to phrase a project about dataset cleaning?",
          "How to describe teamwork in a software project?",
          "Best way to highlight leadership experience on a resume.",
          "How to write an objective statement for a data scientist role?",
          "Tips for writing a cover letter for a tech internship.",
          "Example summary for a recent CS graduate.",
          "How to present skills learned during an internship.",
          "What keywords should I use for an AI research resume?"
        ],
        "Interview Prep": [
          "Mock me: behavioral question for a PM role.",
          "Ask a system design question for a small service.",
          "How to answer 'Tell me about yourself' for SWE?",
          "Tips to handle technical questions under pressure.",
          "Best practices for answering situational interview questions.",
          "Explain the STAR method with an example.",
          "How to discuss failures in an interview?",
          "Questions to ask the interviewer for a data science role.",
          "How to prepare for coding interviews effectively?",
          "What are common mistakes to avoid in interviews?"
        ],
        "Career Path": [
          "Roadmap from QA to SRE in 18 months.",
          "Roles I can apply for with Python+SQL.",
          "How to move from sales to product management?",
          "Career advice for switching from academia to industry.",
          "Skills needed to become a cloud engineer.",
          "Steps to advance from junior to senior developer.",
          "How to build a personal brand in tech?",
          "Tips for networking in the software industry.",
          "What certifications should I pursue for data analytics?",
          "How to plan a career in AI research?"
        ],
        "Upskilling Guide": [
          "Best online courses for learning React in 2024.",
          "How to improve SQL skills quickly?",
          "Resources to learn cloud computing basics.",
          "Steps to get started with machine learning.",
          "How to prepare for AWS certification?",
          "Top free resources to learn Python.",
          "Tips to stay updated with tech trends.",
          "How to learn data visualization tools?",
          "What books to read for software architecture?",
          "How to practice coding challenges daily?"
        ],
        "College Abroad": [
          "Top US universities for computer science.",
          "How to apply for scholarships in Canada?",
          "Tips for writing a Statement of Purpose (SOP).",
          "Best countries for MS in AI and ML.",
          "GRE and TOEFL preparation strategies.",
          "How to get internships while studying abroad?",
          "Visa application process for UK students.",
          "Cost of living in Australia for students.",
          "Work opportunities during studies in Germany.",
          "How to choose the right course for CS masters?"
        ]
      };

      function saveDB() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(DB));
      }

      function updateStats() {
        const pairsCount = Object.keys(DB).length;
        pairsCountEl.textContent = pairsCount;

        const distinctPrompts = new Set(Object.keys(DB).map(k => k.split('|')[0])).size;
        distinctEl.textContent = distinctPrompts;

        totalQueriesEl.textContent = sessionQueries;
        const avgLen = sessionQueries ? Math.round(sessionPrompts.reduce((a,b) => a + b.length, 0) / sessionQueries) : 0;
        avgPromptLengthEl.textContent = avgLen;

        // Most frequent prompt
        const freqMap = {};
        for (const p of sessionPrompts) {
          freqMap[p] = (freqMap[p] || 0) + 1;
        }
        let maxCount = 0, mostFreq = 'N/A';
        for (const p in freqMap) {
          if (freqMap[p] > maxCount) {
            maxCount = freqMap[p];
            mostFreq = p;
          }
        }
        mostFreqPromptEl.textContent = mostFreq;

        distinctAdvisorsEl.textContent = sessionAdvisorsUsed.size;

        // Prompts by advisor
        const advisorCount = {};
        for (const pairKey in DB) {
          const advisor = pairKey.split('|')[1];
          advisorCount[advisor] = (advisorCount[advisor] || 0) + 1;
        }
        promptsByAdvisorEl.innerHTML = '';
        for (const [adv, count] of Object.entries(advisorCount)) {
          const li = document.createElement('li');
          li.textContent = `${adv}: ${count}`;
          promptsByAdvisorEl.appendChild(li);
        }
      }

      function createChatBubble(text, isUser, advisorName = '') {
        const container = document.createElement('div');
        container.classList.add(isUser ? 'msg-user' : 'msg-ai');

        const bubble = document.createElement('div');
        bubble.classList.add('bubble', isUser ? 'user' : 'ai');
        bubble.textContent = text;

        const badge = document.createElement('div');
        badge.classList.add('badge', isUser ? 'user' : 'ai');
        badge.textContent = isUser ? 'USER' : `Advisor: ${advisorName}`;
        bubble.appendChild(badge);

        container.appendChild(bubble);
        return container;
      }

      function addMessageToChat(text, isUser, advisorName = '') {
        const bubble = createChatBubble(text, isUser, advisorName);
        chatBox.appendChild(bubble);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      // Show samples for selected advisor
      function renderSamples(advisor) {
        samplesEl.innerHTML = '';
        if (!(advisor in SAMPLE_PROMPTS)) return;
        for (const prompt of SAMPLE_PROMPTS[advisor]) {
          const btn = document.createElement('button');
          btn.textContent = prompt;
          btn.className = 'px-3 py-1 border rounded bg-white hover:bg-blue-50 text-xs';
          btn.addEventListener('click', () => {
            input.value = prompt;
            input.focus();
          });
          samplesEl.appendChild(btn);
        }
      }

      // Show modal list of all pairs
      function showModal() {
        pairsList.innerHTML = '';
        const entries = Object.entries(DB);
        if (entries.length === 0) {
          pairsList.textContent = 'No stored prompt → response pairs.';
        } else {
          for (const [key, response] of entries) {
            const [prompt, advisor] = key.split('|');
            const div = document.createElement('div');
            div.innerHTML = `<strong>${advisor}</strong><br><em>${prompt}</em><br>${response}`;
            div.classList.add('mb-3', 'p-2', 'border', 'rounded', 'bg-white', 'shadow-sm');
            pairsList.appendChild(div);
          }
        }
        modal.classList.remove('hidden');
      }

      function closeModalFunc() {
        modal.classList.add('hidden');
      }

      // Show the add-response modal for unknown prompt
      let currentUnknownPrompt = '';
      let currentUnknownAdvisor = '';
      function showResponseModal(prompt, advisor) {
        currentUnknownPrompt = prompt;
        currentUnknownAdvisor = advisor;
        respInput.value = '';
        respMeta.textContent = `Prompt: "${prompt}" — Advisor: ${advisor}`;
        respModal.classList.remove('hidden');
        respInput.focus();
      }

      function closeResponseModal() {
        respModal.classList.add('hidden');
        currentUnknownPrompt = '';
        currentUnknownAdvisor = '';
      }

      // Handle prompt submit
      function handleSubmit() {
        const prompt = input.value.trim();
        if (!prompt) return;
        const advisor = advisorSel.value;
        input.value = '';
        addMessageToChat(prompt, true);

        sessionQueries++;
        sessionPrompts.push(prompt);
        sessionAdvisorsUsed.add(advisor);
        updateStats();

        // Check if prompt exists in DB
        const key = `${prompt}|${advisor}`;
        if (DB[key]) {
          // Show stored answer immediately
          setTimeout(() => {
            addMessageToChat(DB[key], false, advisor);
          }, 250);
          statusEl.textContent = 'Response retrieved from local DB.';
        } else {
          // Ask user to add answer manually
          statusEl.textContent = 'Prompt not found — please add a response.';
          showResponseModal(prompt, advisor);
        }
      }

      // Save new response from modal input
      function saveResponse() {
        const response = respInput.value.trim();
        if (!response) {
          alert('Please enter a response before saving.');
          return;
        }
        const key = `${currentUnknownPrompt}|${currentUnknownAdvisor}`;
        DB[key] = response;
        saveDB();
        closeResponseModal();
        addMessageToChat(response, false, currentUnknownAdvisor);
        statusEl.textContent = 'Response saved locally.';
        updateStats();
      }

      // Export DB as JSON download
      function exportDB() {
        const dataStr = JSON.stringify(DB, null, 2);
        const blob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `careeros_kb_${new Date().toISOString().slice(0,10)}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        statusEl.textContent = 'KB exported as JSON file.';
      }

      // Clear the local DB with confirmation
      function clearDB() {
        if (confirm('Are you sure you want to clear the entire local knowledge base?')) {
          DB = {};
          saveDB();
          updateStats();
          statusEl.textContent = 'Local knowledge base cleared.';
          chatBox.innerHTML = '';
        }
      }

      // Suggest a random sample prompt for current advisor
      function suggestSample() {
        const advisor = advisorSel.value;
        if (!(advisor in SAMPLE_PROMPTS)) return;
        const samples = SAMPLE_PROMPTS[advisor];
        if (!samples.length) return;
        const prompt = samples[Math.floor(Math.random() * samples.length)];
        input.value = prompt;
        input.focus();
      }

      // Initialize the page
      function init() {
        updateStats();
        renderSamples(advisorSel.value);
        advisorLabel.textContent = `Advisor: ${advisorSel.value}`;

        advisorSel.addEventListener('change', () => {
          renderSamples(advisorSel.value);
          advisorLabel.textContent = `Advisor: ${advisorSel.value}`;
          input.focus();
        });

        sendBtn.addEventListener('click', handleSubmit);
        input.addEventListener('keydown', e => {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            handleSubmit();
          }
        });

        exportBtn.addEventListener('click', exportDB);
        clearDBBtn.addEventListener('click', clearDB);
        showAllBtn.addEventListener('click', showModal);
        closeModal.addEventListener('click', closeModalFunc);
        suggestBtn.addEventListener('click', suggestSample);

        respSave.addEventListener('click', saveResponse);
        respCancel.addEventListener('click', () => {
          closeResponseModal();
          statusEl.textContent = 'Response entry canceled.';
        });
      }

      // Run init on DOM ready
      window.addEventListener('load', init);
    })();
  </script>
</body>
</html>
